<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>A-Frame 1.7.0 — Sphere drops & bounces</title>

  <!-- A-Frame 1.7.0 -->
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

  <!-- aframe-physics-system (Cannon driver bundled) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.2/dist/aframe-physics-system.min.js"></script>

  <style>
    html,body { height:100%; margin:0; }
    a-scene { width:100%; height:100vh; display:block; }
    #ui { position:absolute; left:12px; top:12px; z-index:999; 
         background:rgba(255,255,255,0.9); padding:8px; border-radius:6px;
         font-family:Arial, sans-serif; font-size:13px; }
    button { padding:6px 8px; }
  </style>
</head>
<body>
  <div id="ui">
    <button id="resetBtn">Reset Sphere</button>
    <span id="status" style="margin-left:10px;color:#222;font-size:12px;">(status)</span>
  </div>

  <!-- Scene: physics debug on so you can see collider wireframes -->
  <a-scene physics="gravity: 0 -9.8 0; debug: true; iterations: 10;">
    <!-- Camera -->
    <a-entity camera position="0 2.2 6" look-controls></a-entity>

    <!-- Lights -->
    <a-entity light="type: ambient; intensity: 0.6"></a-entity>
    <a-entity light="type: directional; intensity: 0.9" position="1 3 2"></a-entity>

    <!-- Ground (static) -->
    <a-plane static-body position="0 0 0" rotation="-90 0 0" width="20" height="20" color="#7BC8A4"></a-plane>

    <!-- Static box: sphere will hit and bounce off this -->
    <a-box id="platform" static-body position="0 0.5 -2.0" rotation="0 25 0"
           width="2" height="1" depth="0.6" color="#4CC3D9"></a-box>

    <!-- Dynamic sphere: uses a physics body. shape:sphere helps stable collision. -->
    <a-sphere id="ball"
              position="0 5 -2"
              radius="0.45"
              color="#FF4136"
              dynamic-body="mass: 1; linearDamping: 0.01; angularDamping: 0.1; shape: sphere"
              physics-material="restitution: 0.85; friction: 0.25">
    </a-sphere>

    <a-sky color="#ECECEC"></a-sky>
  </a-scene>

  <script>
    const ball = document.getElementById('ball');
    const btn = document.getElementById('resetBtn');
    const status = document.getElementById('status');

    // Reset position and clear velocities
    function resetSphere() {
      ball.setAttribute('position', '0 5 -2');
      // If physics body exists, clear velocities and set body position
      if (ball.body) {
        try {
          ball.body.velocity.set(0, 0, 0);
          ball.body.angularVelocity.set(0, 0, 0);
          ball.body.position.set(0, 5, -2);
          if (ball.body.wakeUp) ball.body.wakeUp();
        } catch (e) {
          console.warn('Could not reset ball.body:', e);
        }
      }
    }
    btn.addEventListener('click', resetSphere);

    // When physics attaches, we'll get a 'body-loaded' event
    ball.addEventListener('body-loaded', () => {
      status.textContent = 'physics ready';
      console.log('ball.body:', ball.body);
      // ensure restitution (bounciness) is set on the material if you want to tweak:
      // (the physics system maps physics-material to the Cannon material)
    });

    // Basic runtime detection: if physics script fails, scene should still render primitives.
    // If the page is blank, open DevTools → Console and Network.
    // Common root causes:
    //  - Script load failed (404) → check Network tab for the physics script
    //  - Opening via file:// and a library uses "import" → serve via HTTP (see below)
    // If you get CORS / module errors, run a local server:
    //   python -m http.server 8000
    // then open http://localhost:8000/thisfilename.html
  </script>
</body>
</html>
