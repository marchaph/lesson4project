<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>A-Frame 1.7.0 â€” Sphere drops & bounces on Box (Physics)</title>

  <!-- A-Frame 1.7.0 -->
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

  <!-- aframe-physics-system (wraps cannon.js / cannon-es) -->
  <!-- Using a widely used CDN path for aframe-physics-system -->
  <script src="https://unpkg.com/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>

  <style>
    body { margin: 0; font-family: sans-serif; }
    #ui {
      position: absolute; left: 12px; top: 12px;
      background: rgba(255,255,255,0.9); padding: 8px; border-radius: 6px;
      z-index: 10;
    }
    button { margin: 4px; }
  </style>
</head>
<body>
  <div id="ui">
    <button id="resetBtn">Reset Sphere</button>
    <small>Click & drag scene to look around; scroll to zoom.</small>
  </div>

  <a-scene physics="gravity: 0 -9.8 0; iterations: 10;" embedded>
    <!-- Camera + cursor to look around -->
    <a-entity id="cameraRig" position="0 2.5 6">
      <a-entity camera look-controls wasd-controls></a-entity>
    </a-entity>

    <!-- Lights -->
    <a-entity light="type: ambient; intensity: 0.6"></a-entity>
    <a-entity light="type: directional; intensity: 0.8" position="1 3 2"></a-entity>

    <!-- Ground (static) -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20"
             color="#7BC8A4" static-body
             material="roughness: 1; metalness: 0">
    </a-plane>

    <!-- Static box that the sphere will bounce off of -->
    <a-box id="platform"
           position="0 0.5 -1.0"  <!-- sits slightly above ground -->
           rotation="0 25 0"
           depth="0.6" height="1.0" width="2.0"
           color="#4CC3D9"
           static-body
           material="roughness: 0.6; metalness: 0.05">
    </a-box>

    <!-- A small wall behind the box to better show collisions -->
    <a-box position="0 0.75 -3.2" depth="0.4" height="1.5" width="6"
           color="#9C27B0" static-body material="roughness:0.8;">
    </a-box>

    <!-- Dynamic sphere: it will fall because of gravity and bounce -->
    <!-- Set mass; apply a physics material with restitution (bounciness) -->
    <a-sphere id="ball"
              position="0 6 0"
              radius="0.4"
              segments-width="32" segments-height="16"
              color="#FF4136"
              dynamic-body="mass: 1; linearDamping: 0.01; angularDamping: 0.1"
              material="roughness: 0.2; metalness: 0.0"
              physics-material="restitution: 0.85; friction: 0.2">
      <!-- small visual helper to show velocity via color (optional) -->
    </a-sphere>

    <!-- Small helper boxes to visualize contact points (optional) -->
    <a-entity id="info" position="-3 3 -3" text="value: Sphere demo; color: #000;"></a-entity>

    <!-- Sky -->
    <a-sky color="#ECECEC"></a-sky>
  </a-scene>

  <script>
    // Reset button: re-position sphere and clear velocity so it drops again.
    const resetBtn = document.getElementById('resetBtn');
    const ball = document.getElementById('ball');

    function resetSphere() {
      // Teleport sphere back up and reset velocities in physics body.
      // The physics system exposes a `body` (CANNON.Body) on the element after init.
      ball.setAttribute('position', { x: 0, y: 6, z: 0 });

      // If the physics body exists, clear velocities and rotation
      const phys = ball.body; // aframe-physics-system attaches `body`
      if (phys) {
        phys.velocity.set(0, 0, 0);
        phys.angularVelocity.set(0, 0, 0);
        phys.position.set(0, 6, 0);
        phys.quaternion.set(0, 0, 0, 1);
        // wake up the body in case it was sleeping
        phys.wakeUp && phys.wakeUp();
      }
    }

    resetBtn.addEventListener('click', resetSphere);

    // Safety: wait until physics system sets up the body to ensure the reset works
    ball.addEventListener('body-loaded', () => {
      // The physics system fires 'body-loaded' on elements when the body is attached.
      // Immediately reset to ensure consistent starting state.
      resetSphere();
    });
  </script>
</body>
</html>
